<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="icon" href="./favicon.ico" type="image/x-icon">
		<title>Command Prompt</title>
		<style>
			@font-face {
				font-family: Consolas;
				src: url("./consola.ttf");
			}
			* {
				box-sizing: border-box;
			}
			html,body {
				width: 100%;
				height: 100%;
			}
			body {
				margin: 0;
				overflow: hidden;
			}
			#text-display {
				background-color: rgb(12, 12, 12);
				color: rgb(242, 242, 242);
				overflow: hidden;
			}
			#text::selection {
				background-color: rgb(242, 242, 242);
				color: rgb(12, 12, 12);
			}
			#text {
				background-color: transparent;
				color: transparent;
				resize: none;
				border: none;
				outline: none;
				cursor: default;
				caret-color: transparent;
				overflow: scroll;
			}
			#text,#text-display {
				font-family: Consolas, monospace;
				font-size: 16px;
				position: absolute;
				padding: 0;
				margin: 0;
				width: 100vw;
				height: 100vh;
				white-space: pre-wrap;       /* css-3 */
				white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
				white-space: -pre-wrap;      /* Opera 4-6 */
				white-space: -o-pre-wrap;    /* Opera 7 */
				word-wrap: break-word;       /* Internet Explorer 5.5+ */
			}
		</style>
	</head>
	<body>
		<pre id="text-display"></pre>
		<textarea id="text" spellcheck="false" onkeydown="keydown(event);" onscroll="document.getElementById('text-display').scrollTo(0, this.scrollTop);"></textarea>
	</body>
	<script>
		var cursor = false;
		var path = location.href;
		var editIndex = 0;
		var colors = {
			"0": "black",
			"1": "blue",
			"2": "green",
			"3": "aqua",
			"4": "red",
			"5": "purple",
			"6": "yellow",
			"7": "ghostwhite",
			"8": "gray",
			"9": "lightblue",
			"a": "lime",
			"b": "cyan",
			"c": "orange",
			"d": "magenta",
			"e": "yellow",
			"f": "white"
		};
		document.getElementById("text").value = "Microsoft Windows [Version 10.0.19044.1526]\n(c) Microsoft Corporation. All rights reserved.";
		function goback() {
			let text = document.getElementById("text");
			text.value += `\n\n${path}>`;
			editIndex = text.value.length;
		};
		function gobackNoCommand() {
			let text = document.getElementById("text");
			text.value += `\n${path}>`;
			editIndex = text.value.length;
		};
		function echo(it) {
			document.getElementById("text").value += "\n" + it;
		};
		goback();
		document.getElementById("text-display").innerText = text.value;
		function keydown(e) {
			let text = document.getElementById("text");
			let deselect = false;
			if (text.selectionStart <= editIndex && !(e.key == "Control" || e.key == "Alt" || e.key == "Meta" || e.key == "Shift") && !e.ctrlKey) {
				text.selectionStart = text.selectionEnd = editIndex;
				if (e.code == "Backspace") {
					e.preventDefault();
				};
			};
			setTimeout(function(){
				if (text.value.charAt(text.value.length - 1) == "\n") {
					text.value = text.value.substring(0, text.value.length - 1);
					if (text.value.substring(editIndex, text.value.length) == "") {
						gobackNoCommand();
					} else {
						let command = text.value.substring(editIndex, text.value.length);
						switch (command.split(" ")[0]) {
							case "echo":
								echo(command.substring(command.indexOf(" ") + 1, command.length).replaceAll("\\n", "\n").replaceAll("\\\n", "\\n").replaceAll("%random%", Math.floor(Math.random()*32767)));
							break;
							case "cd":
								let pathtodo = command.substring(command.indexOf(" ") + 1, command.length).replaceAll("\\", "/");
								if (pathtodo.includes(":") || pathtodo.includes("//") || pathtodo.split("")[0] == "/") {
									path = pathtodo;
								} else {
									if (path.slice(-1) == "/") {
										path += pathtodo + "/";
									} else {
										path += "/" + pathtodo;
									};
								};
								location.href = command.substring(command.indexOf(" ")+1, command.length);
							break;
							case "color":
								let color;
								if (command.length < 8) {
									color = ["0", "f"];
								} else {
									color = command.substring(command.indexOf(" ") + 1, command.length).toLowerCase().split("");
								};
								document.getElementById("text-display").style.backgroundColor = colors[color[0]] ?? colors[0];
								document.getElementById("text-display").style.color = colors[color[1]] ?? colors[7];
							break;
							default:
								echo(`'${command.split(" ")[0]}' is not recognized as an internal or external command, operable program or batch file.`);
							break;
						};
						goback();
					};
				};
				document.getElementById("text-display").innerText = text.value;
				if (cursor) {
					document.getElementById("text-display").innerText += "_";
				};
				text.scrollTo(0, text.scrollHeight);
				document.getElementById("text-display").scrollTo(0, document.getElementById("text-display").scrollHeight);
			}, 10);
		};
		var cursorBlink = setInterval(function(){
			let textDisplay = document.getElementById("text-display");
			if (cursor) {
				cursor = false;
				textDisplay.innerText = textDisplay.innerText.substring(0, textDisplay.innerText.length - 1);
			} else {
				cursor = true;
				textDisplay.innerText += "_";
			};
		}, 500);
	</script>
</html>
