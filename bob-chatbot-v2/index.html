<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Bob Chatbot V2</title>
		<style>
			* {
				box-sizing: border-box;
			}
			html,body {
				width: 100%;
				height: 100%;
			}
			body {
				margin: 0;
				overflow: hidden;
			}
			#chatbot {
				width: 100%;
				height: 100%;
				display: flex;
				flex-direction: column;
			}
			#messages {
				width: 100%;
				flex-grow: 1;
				font-size: 20px;
				font-family: Arial, Helvetica, sans-serif;
				padding: 10px;
				border: 2px solid #A0A0A0;
				border-radius: 10px;
				overflow: auto;
			}
			#text-box-container {
				flex-grow: 0;
				width: 100%;
				display: flex;
				flex-direction: row;
			}
			#text-box {
				font-size: 30px;
				padding: 10px;
				border-radius: 30px;
				flex-grow: 1;
				border: 2px solid #A0A0A0;
			}
			#text-box:focus {
				outline: none;
				border: 2px solid #9999FF;
			}
			#enter-button {
				font-size: 30px;
				padding: 10px;
				aspect-ratio: 1 / 1;
				background-color: white;
				color: #A0A0A0;
				border: 2px solid #A0A0A0;
				border-radius: 50%;
			}
			#enter-button:hover {
				color: #888888;
				border: 2px solid #888888;
			}
		</style>
	</head>
	<body>
		<div id="chatbot">
			<div id="messages">
				<b>Bob: </b>hi<br>
			</div>
			<div id="text-box-container">
				<input type="text" id="text-box">
				<button onclick="enter();" id="enter-button">></button>
			</div>
		</div>
		<script>
			function editDistance(s1, s2) {
				s1 = s1.toLowerCase();
				s2 = s2.toLowerCase();
				
				var costs = new Array();
				for (var i = 0; i <= s1.length; i++) {
					var lastValue = i;
					for (var j = 0; j <= s2.length; j++) {
						if (i === 0) {
							costs[j] = j;
						} else {
							if (j > 0) {
								var newValue = costs[j - 1];
								if (s1.charAt(i - 1) !== s2.charAt(j - 1)) {
									newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
								};
								costs[j - 1] = lastValue;
								lastValue = newValue;
							};
						};
					};
					if (i > 0) costs[s2.length] = lastValue;
				};
				return costs[s2.length];
			}
			function similarity(s1, s2) {
				var longer = s1;
				var shorter = s2;
				if (s1.length < s2.length) {
					longer = s2;
					shorter = s1;
				};
				var longerLength = longer.length;
				if (longerLength === 0) {
					return 1.0;
				};
				return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
			};
			function arrayRandom(arr) {
				return arr[Math.floor(Math.random() * arr.length)];
			};

			class ChatBot {
				constructor(responses={}) {
					this.responses = {
						"idk": ["why dont you know", "i dont know isnt an answer", "answer", "answer but dont do idk", "tell me"],
						"how could you say that": ["because i can"],
						"say bob": ["bob"],
						"say something": ["something", "what you just said", "a brick", "a cat", "a door", "a car", "a table", "a broom", "air", "a rock", "a brain", "a human", "a drop of water", "a person", "a computer", "a doorknob", "a toilet", "a blade of grass", "a tissue", "a cloud", "a pine needle", "a tree", "wood", "a plank of wood", "a 2 by 4", "a blob of mush", "a bucket of paint"],
						"bob": ["why did you say my name", "you"],
						"what is a brick": ["a rectangle but 3d and brown"],
						"how do you talk to bob": ["your doing it"],
						"you're*": ["*y'ureu'eru'eru'eru'rue"],
						"your weird": ["*you're"],
						"are you tom": ["does it look like it"],
						"deshaun": ["who is deshaun"],
						"why": ["because i said so", "because", "because tom insists", "because it is", "because they are"],
						"why is it trending": ["because it is", "because the new tom update just dropped in bobcraft"],
						"bruh": ["why are you a technoblade stan"],
						"br": ["why are you a technoblade stan"],
						"brr": ["why are you a technoblade stan"],
						"brrr": ["why are you a technoblade stan"],
						"brrrr": ["why are you a technoblade stan"],
						"brh": ["why are you a technoblade stan"],
						"brrh": ["why are you a technoblade stan"],
						"brrrh": ["why are you a technoblade stan"],
						"brrrrhh": ["why are you a technoblade stan"],
						"brrrrrhh": ["why are you a technoblade stan"],
						"DONT LOOK BEHIND YOU": ["*don't"],
						"why do i have to type something": ["because you just did", "you just did"],
						"how much is it": ["80 bux", "80 bux a pop"],
						"because is not an answer": ["it is", "it is because"],
						"because isnt an answer": ["it is", "it is because"],
						"why dont you know it": ["because my brain is a peanut", "because i dont", "because"],
						"in bobs hometown": ["noted", "im on my way"],
						"i just did": ["you didnt", "not in my book"],
						"i did": ["you didnt", "not in my book"],
						"im not tom": ["yes you are", "tom said you are", "you are"],
						"no i didnt": ["yes you did", "you did"],
						"what is it": ["something", "a human", "idk", "you tell me"],
						"what is the mission": ["find bobs hometown"],
						"stop being fresh": ["im rotten not fresh"],
						"your a robot": ["no im bob"],
						"why dont you know": ["because my brain is a peanut", "because i dont", "because"],
						"why cant you comprehend it": ["because i cant", "because you are a mastermind"],
						"who is tom": ["you", "you are tom"],
						"something": ["did tom tell you to say something", "why did you say something"],
						"why are you my father": ["because i am", "because"],
						"no im not": ["yes you are", "you are", "u r", "yes u are"],
						"yes": ["no", "good you agreed", "disagreed", "agreed", "i disagree", "i agree"],
						"no": ["why not", "disagreed", "agreed", "i disagree", "i agree"],
						"yea": ["no"],
						"whats your merch": ["my new bob hoodie", "its 80 bux a pop and a brain special"],
						"how much is it": ["tis 80 bux", "its 80 bux a pop", "ninety nine dollars and niety nine cents"],
						"how much": ["tis 80 bux", "its 80 bux a pop", "ninety nine dollars and niety nine cents"],
						"w-": ["hy did bob talk to bob"],
						"it is": ["no it isnt", "it isnt", "disagreed", "agreed", "i disagree", "i agree"],
						"what is something": ["something", "what you just said", "a brick", "a cat", "a door", "a car", "a table", "a broom", "air", "a rock", "a brain", "a human", "a drop of water", "a person", "a computer", "a doorknob", "a toilet", "a blade of grass", "a tissue", "a cloud", "a pine needle", "a tree", "wood", "a plank of wood", "a 2 by 4", "a blob of mush", "a bucket of paint"],
						"what color": ["blue", "red", "green", "purple", "tan", "peach", "black", "white", "pink", "brown", "gray", "gold", "silver", "yellow"],
						"say a random color": ["blue", "red", "green", "purple", "tan", "peach", "black", "white", "pink", "brown", "gray", "gold", "silver", "yellow"],
						"and why is that": ["because"],
						"this one or that one": ["this one", "that one"],
						"say anything": ["anything"],
						"smash your keyboard": ["erttg yhertguy ugye", "sdyhrtfguiyerotcyuiw", "rwetioytnhyweiourtnweoirt", "teruiho", "wer", "wueitbwueit", "qwertyuio", "wuepuoiwertuoiuioptweruiuwertipoy", "bhsd gfr", "pqw", "78er3956t342w", "45bdfngsusrt", "rfeg jhkserh t", "ui943yw5ye45", "i dont have a keyboard"],
						"then how are you typing": ["with a mouse", "with my brain", "magic"],
						"how are you typing": ["with a mouse", "with my brain", "magic"],
						"then how r u typing": ["with a mouse", "with my brain", "magic"],
						"im not": ["you are", "yes you are", "u r", "yes u are"],
						"where is it": ["49 johnson avenue", "947 hamilton road", "11 shawn drive", "somewhere"],
						"where is bobs hometown": ["REDACTED", "bob knows where"],
						"where is somewhere": ["where some is", "idk"],
						"good": ["why is it good"],
						"are you weird": ["yes", "no", "maybe"],
						"say bob but big": ["<br>#..........................#..........<br>#..........................#..........<br>#..........................#..........<br>#####......####....#####..<br>#........#..#........#..#........#<br>#........#..#........#..#........#<br>#####......####....#####.."],
						"tom": ["why did you say your own name", "why did you say your name"],
						"Message bob...": ["why did you type whats in the box", "i ate a brick, to: bob, from: bob"],
						"why did you eat a brick": ["who said i cant"],
						"y did u eat a brick": ["who said i cant"],
						"why did u eat a brick": ["who said i cant"],
						"why dont u know": ["because", "because my brain is a peanut"],
						"r u bob": ["yes", "read my name"],
						"savage": ["why are you talking about mike"],
						"hi": ["hi", "hello"],
						"because": ["because why", "why did you say because"],
						"are you bob": ["yes", "read my name"],
						"r u tom": ["no", "you are"],
						"are u tom": ["no", "you are"],
						"hello": ["hi", "hello"],
						"say bob 3 times": ["bob bob bob"],
						"you dont": ["why", "why dont i", "i do"],
						"woercyinutwtoreymxuimyxermyiueywryntoiucyeroitucykasqwertyuiopasdfghjklzxcvbnm": ["why did u smash ur keyboard"],
						"are you a robot": ["yes", "maybe yes maybe no"],
						"are you a dream stan": ["yes", "no", "maybe"],
						"are you the grinch": ["no", "are you?", "im not the grinch and i didnt steal christmas"],
						"crash your system": ["101001110101011110101010", "afuiagfswugasdjfhbasdc hj", "19563528548"],
						"how old are you": ["87", "87 yo", "87 years old"],
						"ok": ["ok", "okay", "ask a random question"],
						"okay": ["ok", "okay", "ask a random question"],
						"are you friends with tom": ["you are tom", "thats you", "maybe", "idk", "i dont know"],
						"are you friends with fred": ["who is fred", "says tom"],
						"are you friends with mike": ["no", "maybe", "mike is trash"],
						"it isnt": ["yes it is", "it is", "send proof"],
						"i didnt": ["you did", "disagreed", "what didnt u do"],
						...responses
					};
					this.error = "i didnt quite get that";
					this.lastBobMessage = "hi";
				};
				getResponse(message, train=false) {
					var correctedMessage = this.getMostSimilar(message);
					if (train) {
						this.learnResponse(this.lastBobMessage, message);
					};
					var bobResponse = arrayRandom(this.responses[correctedMessage]);
					this.lastBobMessage = bobResponse;
					return bobResponse;
				};
				getMostSimilar(text) {
					return Object.keys(this.responses).sort((a, b) => similarity(b, text) - similarity(a, text))[0] ?? this.error;
				};
				learnResponse(message, response) {
					this.responses[message] ??= [];
					this.responses[message].push(response);
				};
			};
			function writeOut(text) {
				document.getElementById("messages").innerHTML += text;
			};
			function escapeHTML(un){
				return un
					.replace(/&/g, "&amp;")
					.replace(/</g, "&lt;")
					.replace(/>/g, "&gt;")
					.replace(/"/g, "&quot;")
					.replace(/'/g, "&#039;");
			};
			var bob = new ChatBot();
			var bobTyping = false;
			async function enter(text=document.getElementById("text-box").value) {
				var textbox = document.getElementById("text-box");
				text = text.trim();
				if (textbox.value.length > 0 && textbox.value.match(/\S/g) !== null && !bobTyping) {
					var messages = document.getElementById("messages");
					writeOut("<b>You: </b>" + escapeHTML(text) + "<br>");
					textbox.value = "";
					var bobResponse = bob.getResponse(text, true);
					writeOut("<b>Bob: </b>");
					bobTyping = true;
					for (let i = 0; i < bobResponse.length; i++) {
						writeOut(bobResponse[i]);
						messages.scrollTo(0, messages.scrollHeight);
						await wait(randInt(10, 80));
					};
					bobTyping = false;
					writeOut("<br>");
				};
			};
			async function wait(ms) {
				return new Promise(res => setTimeout(res, ms));
			};
			function randInt(min, max) {
				return Math.floor((max - min) * Math.random() + min);
			};

			document.getElementById("text-box").addEventListener("keydown", e => {
				if (e.key === "Enter") {
					enter();
				};
			});
			document.getElementById("text-box").focus();
		</script>
	</body>
</html>
