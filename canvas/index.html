<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>canvas</title>
		<style>
			* {
				box-sizing: border-box;
			}
			html,body {
				width: 100%;
				height: 100%;
			}
			body {
				margin: 0;
				overflow: hidden;
			}
			#canvas {
				width: 100vw;
				height: 100vh;
			}
			img {
				z-index: 5;
				top: 0px;
				right: 0px;
				position: absolute;
				width: 30vw;
				height: 30vh;
				display: none;
			}
		</style>
	</head>
	<body onkeydown="keysDown[event.key]=true" onkeyup="keysDown[event.key]=false" oncontextmenu="event.preventDefault()">
		<canvas id="canvas"></canvas>
	</body>
	<script>
		var Sprite = class Sprite {
			constructor(x, y, width, height, color) {
				this.x = x ?? 10;
				this.y = y ?? 10;
				this.width = width ?? 100;
				this.height = height ?? 100;
				if (typeof color !== "undefined") {
					this.color = color;
				};
			};
			translate(x, y) {
				this.x += x;
				this.y += y;
			};
			render(){
				let oldFill = ctx.fillStyle;
				ctx.fillStyle = this.color ?? oldFill;
				ctx.fillRect(this.x, this.y, this.width, this.height);
				ctx.fillStyle = oldFill;
			};
			get rect() {
				return {
					left: this.x,
					right: this.x+this.width,
					top: this.y,
					bottom: this.y+this.height,
					center: {x: (this.x+(this.x+this.width))/2, y: (this.y+(this.y+this.height))/2},
					width: this.width,
					height: this.height
				}
			};
		};
		var canvas = document.getElementById("canvas");
		var width = window.innerWidth;
		var height = window.innerHeight;
		var ctx = canvas.getContext("2d");
		var keysDown = {};
		var sprites = {
			box: new Sprite((width/2)-(100/2), (height/2)-(100/2), 100, 100, "black"),
			redbox: new Sprite(100, 100, 100, 100, "red")
		};
		var xv = 0;
		var yv = 0;
		var onGround = false;

		function isDown(key) {
			return keysDown[key] ?? false;
		};

		canvas.setAttribute("width", width);
		canvas.setAttribute("height", height);

		var loop = setInterval(function(){
			//set width and height
			if (width !== window.innerWidth || height !== window.innerHeight) {
				width = window.innerWidth;
				height = window.innerHeight;
				canvas.setAttribute("width", width);
				canvas.setAttribute("height", height);
			};

			// calculate stuff
			xv += (isDown("ArrowRight") - isDown("ArrowLeft"))*1;
			sprites.box.x += xv;
			if (sprites.box.rect.left < 0) {
				sprites.box.x = 0;
				xv = 0;
			};
			if (sprites.box.rect.right > width) {
				sprites.box.x = width-sprites.box.width;
				xv = 0;
			};
			sprites.box.y += yv;
			if (sprites.box.rect.top < 0) {
				sprites.box.y = 0;
				yv = 0;
			};
			if (sprites.box.rect.bottom > height) {
				sprites.box.y = height-sprites.box.height;
				yv = 0;
				onGround = true;
			} else {
				onGround = false;
			};
			if (onGround && isDown("ArrowUp")) {
				yv -= 15;
				console.log(isDown("ArrowUp"));
			};
			xv *= 0.9;
			xv *= 0.9;
			yv += 0.5;
			
			//clear
			ctx.clearRect(0, 0, width, height);

			//sprites
			sprites.box.render();
			sprites.redbox.render();

			//draw stuff
		}, 10);
	</script>
</html>
