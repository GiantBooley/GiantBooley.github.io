<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Fat guy</title>
		<style>
			* {
				box-sizing: border-box;
			}
			html,body {
				width: 100%;
				height: 100%;
			}
			body {
				margin: 0;
				overflow: hidden;
			}
			#canvas {
				width: 100%;
				height: 100%;
			}
			#canvas-wrapper {
				width: 100%;
				height: 100%;
				outline: none;
			}
			#images {
				display: none;
			}
			#shop-button {
				top: 10px;
				right: 10px;
			}
			button {
				position: absolute;
				border: 10px solid black;
				background-color: white;
				transition-duration: 0.03s;
				user-select: none;
				font-family: monospace;
				padding: 1em 2em;
				font-size: 20px;
			}
			button:hover {
				transform: scale(1.05, 1.05);
			}
			button:active {
				transform: scale(0.95, 0.95);
			}
			#shop {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 90%;
				height: 90%;
				border: 10px solid black;
				background-color: white;
				outline: 100vw solid rgba(0, 0, 0, 0.1);
				padding: 20px;
				font-family: monospace;
				display: none;
			}
			#guy-name {
				font-size: 30px;
			}
			#times-fatness-button,#upgrade-guy-button {
				width: 80%;
				display: block;
				position: absolute;
				right: 10px;
			}
			#times-fatness-button {
				top: 10px;
			}
			#upgrade-guy-button {
				bottom: 10px;
			}
		</style>
		<div id="images">
			<img src="./assets/textures/background.jpg" id="img-background">
			<img src="./assets/textures/bobo.png" id="img-burger-bobo">
			<img src="./assets/textures/wate.png" id="img-burger-wate">
			<img src="./assets/textures/mac_and_cheese_burger.png" id="img-burger-mac-and-cheese-burger">
			<img src="./assets/textures/rotten_burger.png" id="img-burger-rotten-burger">
			<img src="./assets/textures/bacon_gurger.png" id="img-burger-bacon-gurger">
			<img src="./assets/textures/tred_mil.png" id="img-burger-tred-mil">
			<img src="./assets/textures/carit.png" id="img-burger-carit">
			<img src="./assets/textures/super_nasty_burger.png" id="img-burger-super-nasty-burger">
			<img src="./assets/textures/pumin.png" id="img-burger-pumin">
			<img src="./assets/textures/pi.png" id="img-burger-pi">
			<img src="./assets/textures/anina.png" id="img-anina">
		</div>
	</head>
	<body>
		<div id="canvas-wrapper" tabindex="0" onkeydown="keysDown[event.code] = true;" onkeyup="keysDown[event.code] = false;" onmousemove="mouseMove(event);">
			<canvas id="canvas"></canvas>
			<div id="shop">
				<p id="guy-name">guy: anina</p>
				<img src="./assets/textures/anina.png" alt="guy image" id="guy-image">
				<button id="times-fatness-button">2x fatness: 50 fatness</button><br>
				<button id="upgrade-guy-button">upgrade guy: 100 fatness</button>
			</div>
			<button id="shop-button">SHOP</button>
		</div>
	</body>
	<script>
		class Burger { // type, fatness, image, scale, spawnRequirement, eatRequirement, eatFunction
			constructor(args) {


				this.type = args.type;
				this.fatness = args.fatness;
				this.image = document.getElementById("img-" + args.image);
				this.scale = args.scale;
				this.hitboxRadius = 0; //Math.max(this.image.naturalWidth, this.image.naturalHeight) / 2;
				this.x = playerX + lerp(canvas.width / -2, canvas.width / 2, Math.random());
				this.y = playerY + lerp(canvas.height / -2, canvas.height / 2, Math.random());
				this.eatFunction = args.eatFunction;
				this.time = 1000;
			};
			draw() {
				ctx.drawImage(this.image, coordinateX(this.x - (this.image.width / 2) * this.scale), coordinateY(this.y - (this.image.height / 2) * this.scale), this.image.width * this.scale, this.image.height * this.scale);
			};
			eat() {
				this.eatFunction(this);
			}
			get hitbox() {
				console.log("getting hitbox: " + this.type);
				return {
					left: this.x - (this.image.width / 2) * this.scale,
					right: this.x + (this.image.width / 2) * this.scale,
					top: this.y - (this.image.height / 2) * this.scale,
					bottom: this.y + (this.image.height / 2) * this.scale
				};
			}
		};

		const canvas = document.getElementById("canvas");
		canvas.width = innerWidth;
		canvas.height = innerHeight;
		const ctx = canvas.getContext("2d");

		ctx.font = "20px monospace";

		var playerX = 0;
		var playerY = 0; // max player = 72057594037927940
		var playerXV = 0;
		var playerYV = 0;
		var cameraX = 0;
		var cameraY = 0;
		var keysDown = {};
		var mouseX = canvas.width / 2;
		var mouseY = canvas.height / 2;
		var fatness = 0;
		var burgers = [];
		var shopOpen = false;
		var fps = 0;
		var playerImage = document.getElementById("img-anina");
		var guyNumber = 0;
		var guys = [
			"anina",
			"amon",
			"champ99",
			"champ99",
			"frank",
			"santa",
			"big chungus",
			"fat belly",
			"pikachu",
			"fat rat",
			"buzz",
			"superman",
			"sans",
			"shrek",
			"im luggin it",
			"stranger",
			"gun guy",
			"ash",
			"gabe the dog",
			"fatty",
			"ronald mcdonald",
			"albert einstein",
			"dentist",
			"steve",
			"lumberjack",
			"bob ross",
			"thanos",
			"donald trump"
		];

		Array.prototype.random = function random() {
			return this[Math.floor(Math.random() * this.length)];
		};
		function lerp(min, max, mult) {
			return (max - min) * mult + min;
		}

		var burgerTypes = {
			"bobo":						{type: "bobo",						fatness: 1,			image: "burger-bobo",						scale: 1.0,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"wate":						{type: "wate",						fatness: 2,			image: "burger-wate",						scale: 0.5,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"mac and cheese burger":	{type: "mac and cheese burger",		fatness: 4,			image: "burger-mac-and-cheese-burger",		scale: 0.5,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"rotten burger":			{type: "rotten burger",				fatness: 5,			image: "burger-rotten-burger",				scale: 0.8,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"bacon gurger":				{type: "bacon gurger",				fatness: 10,		image: "burger-bacon-gurger",				scale: 0.7,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"tred mil":					{type: "tred mil",					fatness: 10,		image: "burger-tred-mil",					scale: 0.7,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"carit":					{type: "carit",						fatness: 10,		image: "burger-carit",						scale: 0.3,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"super nasty burger":		{type: "super nasty burger",		fatness: 25,		image: "burger-super-nasty-burger",			scale: 0.5,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"pumin":					{type: "pumin",						fatness: 50,		image: "burger-pumin",						scale: 0.6,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
			"pi":						{type: "pi",						fatness: 250,		image: "burger-pi",							scale: 0.5,		spawnRequirement: 0, 	eatRequirement: 0, eatFunction: burger => {}},
		};
		function createBurger(type) { //               type,    fatness, image, 							   scale, spawnRequirement, eatRequirement, eatFunction
			console.log(type);
			return {
				"bobo":						new Burger(burgerTypes[type]),
				"wate":						new Burger(burgerTypes[type]),
				"mac and cheese burger":	new Burger(burgerTypes[type]),
				"rotten burger":			new Burger(burgerTypes[type]),
				"bacon gurger":				new Burger(burgerTypes[type]),
				"tred mil":					new Burger(burgerTypes[type]),
				"carit":					new Burger(burgerTypes[type]),
				"super nasty burger":		new Burger(burgerTypes[type]),
				"pumin":					new Burger(burgerTypes[type]),
				"pi":						new Burger(burgerTypes[type])
			}[type];
		};
		function isDown(code) {
			return keysDown[code] ?? false;
		};
		function distance(p1, p2) {
			return Math.sqrt(((p1[0] - p2[0]) ** 2) + ((p1[1] - p2[1]) ** 2));
		};
		function mouseMove(e) {
			mouseX = e.clientX - canvas.width / 2;
			mouseY = e.clientY - canvas.height / 2;
		};
		function playerHitbox() {
			return {
				left: playerX - playerImage.width / 2,
				right: playerX + playerImage.width / 2,
				top: playerY - playerImage.height / 2,
				bottom: playerY + playerImage.height / 2
			};
		};
		function deg2rad(degrees) {
			return degrees * (Math.PI / 180);
		};
		function coordinateX(x) {
			return x - cameraX + canvas.width / 2;
		};
		function coordinateY(y) {
			return y - cameraY + canvas.height / 2;
		};

		function drawImage(name, x, y, width, height) {
			ctx.drawImage(document.getElementById("img-" + name), x, y, width, height);
		};
		function round(number) {
			return Math.floor(number * 1000) / 1000;
		};
		Math.mod = function mod(n, t) {
			return ((n % t) + t) % t;
		};


		function tick() {
			if (Math.random() < 1 / 100) {
				//for (let i = 0; i < 1; i++) {
					burgers.push(createBurger(Object.keys(burgerTypes).random()));
					//burgers[burgers.length - 1].x = playerX;
					//burgers[burgers.length - 1].y = playerY;
				//};
			};
			let speed = 5;
			playerX += playerXV;
			playerY += playerYV;

			playerXV *= 0.9;
			playerYV *= 0.9;
			if (isDown("ArrowLeft") || isDown("ArrowRight")) {
				playerXV = (isDown("ArrowRight") - isDown("ArrowLeft")) * speed;
			};
			if (isDown("ArrowUp") || isDown("ArrowDown")) {
				playerYV = (isDown("ArrowDown") - isDown("ArrowUp")) * speed;
			};
			let times = 5;
			cameraX = (cameraX * (times - 1) + playerX) / times;
			cameraY = (cameraY * (times - 1) + playerY) / times;

			let gridWidth = 2;

			ctx.clearRect(0, 0, canvas.width, canvas.height);

			drawImage("background", 0, 0, canvas.width, canvas.height);

			ctx.fillStyle = `rgba(255, 255, 255, 0.1)`;
			for (let x = gridWidth / -2; x < canvas.width + gridWidth * 10; x += gridWidth * 10) {
				ctx.fillRect(x - Math.mod(cameraX, gridWidth * 10), 0, gridWidth, canvas.height);
			};
			for (let y = gridWidth / -2; y < canvas.height + gridWidth * 10; y += gridWidth * 10) {
				ctx.fillRect(0, y - Math.mod(cameraY, gridWidth * 10) - gridWidth / 2, canvas.width, gridWidth);
			};
			ctx.fillStyle = "rgb(20, 20, 20)";
			ctx.fillRect(coordinateX(72057594037927940), 0, 10, canvas.height);
			ctx.fillRect(0, coordinateY(72057594037927940), canvas.width, 10);
			ctx.fillRect(coordinateX(-72057594037927940), 0, 10, canvas.height);
			ctx.fillRect(0, coordinateY(-72057594037927940), canvas.width, 10);

			ctx.drawImage(playerImage, coordinateX(playerX - playerImage.width / 2), coordinateY(playerY - playerImage.height / 2));

			ctx.fillStyle = "white";
			burgers.forEach((burger, i) => {
				console.log("drawing burger: " + burger.type);
				if ((playerHitbox().right > burger.hitbox.left && playerHitbox().left < burger.hitbox.right && playerHitbox().bottom > burger.hitbox.top && playerHitbox().top < burger.hitbox.bottom) || burger.time <= 0) {
					burgers.splice(i, 1);
					fatness += Math.abs(burger.fatness);
				} else {
					if (burger.x - cameraX > canvas.width / -2 && burger.x - cameraX < canvas.width / 2 && burger.y - cameraY > canvas.height / -2 && burger.y - cameraY < canvas.height / 2) {
						burger.draw();
						//ctx.fillText(burger.time, coordinateX(burger.x), coordinateY(burger.y));
					};
					burger.time--;
				};
			});

			ctx.fillStyle = "black";
			`fatness: ${fatness}\nx: ${round(playerX)}\ny: ${round(playerY)}\nxv: ${round(playerXV)}\nyv: ${round(playerYV)}\ncamera x offset: ${round(cameraX - playerX)}\ncamera y offset: ${round(cameraY - playerY)}\nfps: ${round(fps)}`.split("\n").forEach((text, i) => {
				ctx.fillText(text, 0, (i + 1) * 20);
			
			});
		};

		var lastTick = Date.now();
		function loop() {
			tick();
			fps = 1000 / (Date.now() - lastTick);
			lastTick = Date.now();
			requestAnimationFrame(loop);
		};
		requestAnimationFrame(loop);
	</script>
</html>
