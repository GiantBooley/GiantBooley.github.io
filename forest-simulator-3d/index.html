<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>forest simulator 3d</title>
		<style>
			* {
				box-sizing: border-box;
			}
			html,body {
				width: 100%;
				height: 100%;
			}
			body {
				margin: 0;
				overflow: hidden;
			}
			#canvas-wrapper,#game {
				width: 100%;
				height: 100%;
				outline: none;
			}
			#game {
				user-select: none;
			}
			#canvas {
				width: 100%;
				height: 100%;
			}
			#shop-button {
				position: absolute;
				top: 10px;
				right: 10px;
				color: black;
				background-color: white;
				border: 5px solid black;
				border-radius: 5px;
				padding: 10px;
				font-family: Arial, Helvetica, sans-serif;
				font-size: 20px;
			}
			#shop {
				display: none;
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				background-color: white;
				border-radius: 10px;
				border: 5px solid black;
				padding: 5px;
			}
			#stats {
				margin: 0;
				position: absolute;
				left: 10px;
				top: 2px;
				font-family: Arial, sans-serif;
				color: yellow;
				font-size: 30px;
				text-shadow: 0px 0px 3px black;
			}
			h1,h2,h3,h4 {
				margin: 0;
			}
			#health {
				position: absolute;
				bottom: 0px;
				left: 0px;
				width: 600px;
				height: 50px;
				background-color: black;
			}
			#health-inner {
				width: 600px;
				height: 50px;
				background-color: rgb(0, 255, 0);
			}
			#joystick {
				position: absolute;
				display: flex;
				align-items: center;
				justify-content: center;
				bottom: 100px;
				right: 100px;
				width: 200px;
				height: 200px;
				background-color: gray;
				border-radius: 50%;
				opacity: 0.8;
				display: none;
			}
			#circle-thing {
				width: 50px;
				height: 50px;
				background-color: lightgray;
				border-radius: 50%;
				transform: translate(0px, 0px);
			}
		</style>
	</head>
	<body>
		<div id="game" tabindex="0" onmouseup="joystick.mouseUp(event);" ontouchend="joystick.mouseUp(event);" onmousemove="joystick.mouseMove(event);" ontouchmove="joystick.mouseMove(event);" oncontextmenu="return false;">
			<div id="canvas-wrapper" tabindex="0" onkeydown="keyDownFunction(event);" onkeyup="keysDown[event.key] = false;">
				<canvas id="canvas"></canvas>
			</div>
			<div id="stats">score: -<br>coins: -</div>
			<button id="shop-button" onclick="shopButton();">SHOP</button>
			<div id="health">
				<div id="health-inner"></div>
			</div>
			<div id="joystick" onmousedown="joystick.mouseDown(event);" ontouchstart="joystick.mouseDown(event);"><div id="circle-thing"></div></div>
		</div>
		<div id="shop">
			<h1>shop</h1>
			<hr>
			<input type="checkbox" id="joystick-checkbox"><label for="joystick-checkbox">joystick</label>
			<div id="boots">
				<h3>boots</h3>
				<button onclick="clickShoeButton(this, 'sketchers');">Sketchers (0 coins)</button><br>
				<button onclick="clickShoeButton(this, 'running shoes');">Running shoes (50 coins)</button><br>
				<button onclick="clickShoeButton(this, 'tennis rackets');">Tennis rackets (100 coins)</button><br>
				<button onclick="clickShoeButton(this, 'spring boots');">Spring boots (120 coins)</button>
			</div><br>
			<div id="food">
				<h3>food</h3><br>
				<label>apple</label><label id="apple-howmany">(0)</label><button onclick="devourFood('apple');">devour</button><button onclick="purchaseFood('apple');">purchase (5 coins)</button><br>
				<label>bread</label><label id="bread-howmany">(0)</label><button onclick="devourFood('bread');">devour</button><button onclick="purchaseFood('bread');">purchase (10 coins)</button><br>
				<label>burger</label><label id="burger-howmany">(0)</label><button onclick="devourFood('burger');">devour</button><button onclick="purchaseFood('burger');">purchase (14 coins)</button><br>
				<label>cold meal</label><label id="cold-meal-howmany">(0)</label><button onclick="devourFood('cold meal');">devour</button><button onclick="purchaseFood('cold meal');">purchase (19 coins)</button><br>
				<label>meal</label><label id="meal-howmany">(0)</label><button onclick="devourFood('meal');">devour</button><button onclick="purchaseFood('meal');">purchase (23 coins)</button><br>
				<label>warm meal</label><label id="warm-meal-howmany">(0)</label><button onclick="devourFood('warm meal');">devour</button><button onclick="purchaseFood('warm meal');">purchase (27 coins)</button><br>
				<label>hot meal</label><label id="hot-meal-howmany">(0)</label><button onclick="devourFood('hot meal');">devour</button><button onclick="purchaseFood('hot meal');">purchase (31 coins)</button><br>
				<label>crispy gooey homemade mac and cheese</label><label id="crispy-gooey-homemade-mac-and-cheese-howmany">(0)</label><button onclick="devourFood('crispy gooey homemade mac and cheese');">devour</button><button onclick="purchaseFood('crispy gooey homemade mac and cheese');">purchase (34 coins)</button><br>
				<label>cow brain</label><label id="cow-brain-howmany">(0)</label><button onclick="devourFood('cow brain');">devour</button><button onclick="purchaseFood('cow brain');">purchase (38 coins)</button><br>
				<label>filling warm meal</label><label id="filling-warm-meal-howmany">(0)</label><button onclick="devourFood('filling warm meal');">devour</button><button onclick="purchaseFood('filling warm meal');">purchase (41 coins)</button>
			</div><br>
			<div id="stuff">
				<h3>stuff</h3><br>
				<label>ladder</label><label id="ladder-howmany">(0)</label><button onclick="placeLadder();">place</button><button onclick="purchaseLadder();">purchase (10 coins)</button>
			</div>
		</div>
	</body>
	<script>
		const canvas = document.getElementById("canvas");
		canvas.width = innerWidth;
		canvas.height = innerHeight;
		const ctx = canvas.getContext("2d");
		document.getElementById("canvas-wrapper").focus();

		class Tree {
			constructor() {
				this
			};
		};

		var keysDown = [];
		function isDown(key) {
			return keysDown[key] ?? false;
		};
		class CanvasImage {
			constructor(src) {
				this.image = new Image();
				this.image.src = src;
				this.loaded = false;
				let canvasimagething = this;
				this.image.onload = function() {
					canvasimagething.loaded = true;
					imagesLoaded++;
					if (imagesLoaded == Object.keys(images).length) {
						loop();
					}; 
				};
			};
		};
		class Joystick {
			constructor(element) {
				this.angle = 0;
				this.strength = 0;
				this.isMouseDown = false;
				this.element = element;
			};
			mouseMove(e) {
				if (!shop) {
					if (e.touches) {
						e = e.touches[0];
					};
					let coords = this.coordinates(e.clientX, e.clientY);
					let rect = this.element.getBoundingClientRect();
					let xy = this.coordinates(rect.x, rect.y);
					if (this.isMouseDown) {
						this.angle = Math.atan2(coords[0], coords[1]) * 180 / Math.PI;
						this.strength = clamp(Math.sqrt((coords[0] - (xy[0] + rect.width / 2)) ** 2 + (coords[1] - (xy[1] + rect.height / 2)) ** 2) / 100, 0, 1);
					};
					this.updateCircle();
				};
			};
			mouseUp(e) {
				if (!shop) {
					if (e.touches) {
						e = e.touches[0];
					};
					this.isMouseDown = false;
					this.angle = 0;
					this.strength = 0;
					this.updateCircle();
				};
			};
			mouseDown(e) {
				if (!shop) {
					if (e.touches) {
						e = e.touches[0];
					};
					this.isMouseDown = true;
					this.mouseMove(e);
				};
			};
			coordinates(x, y) {
				let rect = this.element.getBoundingClientRect();
				return [x - (rect.x + rect.width / 2), y - (rect.y + rect.height / 2)];
			};
			updateCircle() {
				document.getElementById("circle-thing").style.transform = "translate(" + (Math.sin(this.angle * Math.PI / 180) * this.strength * 100) + "px, " + (Math.cos(this.angle * Math.PI / 180) * this.strength * 100) + "px)";
			};
		};
		Math.mod = function(a, b) {
			return ((a % b) + b) % b;
		};

		var playerX = 75;
		var playerY = -900;
		var playerXV = 0;
		var playerYV = 0;
		var cameraX = 0;
		var cameraY = 0;
		var onGround = false;
		var seeds = [];
		var imagesLoaded = 0;
		var images = {
			guy: new CanvasImage("https://t4.ftcdn.net/jpg/01/73/40/15/360_F_173401516_HH7aV0os9LEum5ayYNrtoovV1jYrt561.jpg"),
			sky: new CanvasImage("https://media.hswstatic.com/eyJidWNrZXQiOiJjb250ZW50Lmhzd3N0YXRpYy5jb20iLCJrZXkiOiJnaWZcL3doeS1pcy1za3ktYmx1ZS5qcGciLCJlZGl0cyI6eyJyZXNpemUiOnsid2lkdGgiOjgyOH19fQ=="),
			grass: new CanvasImage("https://images.pexels.com/photos/413195/pexels-photo-413195.jpeg?cs=srgb&dl=pexels-pixmike-413195.jpg&fm=jpg"),
			hills: new CanvasImage("https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Chocolate_Hills_overview.JPG/1200px-Chocolate_Hills_overview.JPG"),
			ice: new CanvasImage("https://media.istockphoto.com/id/466513257/photo/image-of-light-blue-ice-design.jpg?s=612x612&w=0&k=20&c=tkgdD6LDAjjDL-J_OCc2tkN924FLtjvgSeQWgVBY5-Y="),
			snow: new CanvasImage("https://t4.ftcdn.net/jpg/00/73/39/95/360_F_73399559_6z3WIVyR5fPvXAW96ZFG1RBHsz6qVn4R.jpg"),
			dirt: new CanvasImage("https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Dirt.JPG/640px-Dirt.JPG"),
			stones: new CanvasImage("https://d3mvlb3hz2g78.cloudfront.net/wp-content/uploads/2016/01/thumb_720_450_f_28.jpg"),
			stone: new CanvasImage("https://media.istockphoto.com/photos/light-grey-black-slate-stone-background-or-texture-picture-id1164746310?b=1&k=20&m=1164746310&s=612x612&w=0&h=nj0fWpCXBGNXhcUuWhXIF3HmcZiXMagkQ-DyPHAXLiw="),
			darkStone: new  CanvasImage("https://media.istockphoto.com/id/1136387527/photo/black-gray-grunge-background-dirty-concrete-wall-stucco-vintage-rock-texture-ombre-dark-stone.jpg?b=1&s=170667a&w=0&k=20&c=iUFh6s42MVX40KVd7bmkfcPHtMjYvqNsVndFQ2dMFWY="),
			stoneBackground: new CanvasImage("https://img.freepik.com/premium-photo/cave-wall-background_181627-531.jpg?w=2000"),
			packedSnow: new CanvasImage("https://thumbs.dreamstime.com/b/snow-surface-full-frame-background-texture-pattern-14970280.jpg"),
			magma: new CanvasImage("https://media.wired.co.uk/photos/606da0c989f3babb1f0133fb/master/w_1600%2Cc_limit/Lava.jpg"),
			lava: new CanvasImage("https://3docean.img.customer.envatousercontent.com/files/371574722/Image+Preview.jpg?auto=compress%2Cformat&fit=crop&crop=top&w=590&h=590&s=dc0fcc220b7f9d9b06eedf277f6f0844"),
			coin: new CanvasImage("https://m.media-amazon.com/images/I/51VLhMGtaTL._AC_SY1000_.jpg"),
			gem: new CanvasImage("https://cdn.britannica.com/78/170778-131-D35E060F/Reflections-diamond.jpg"),
			mysteryCrate: new CanvasImage("https://thumbs.dreamstime.com/b/crate-question-10722232.jpg"),
			ladder: new CanvasImage("https://m.media-amazon.com/images/I/71l4pWDxfTL.jpg")
		};
		var layers = {
			"-6": [images.lava.image, 0.9],
			"-5": [images.magma.image, 0.77],
			"-4": [images.darkStone.image, 0.65],
			"-3": [images.stone.image, 0.7],
			"-2": [images.stones.image, 0.75],
			"-1": [images.dirt.image, 0.8],
			"0": [images.grass.image, 0.75],
			"1": [images.stone.image, 0.65],
			"2": [images.snow.image, 0.9],
			"3": [images.ice.image, 0.96]
		};
		//=================//
		// -==ROW STUFF=-- //
		//=================//
		var rows = {};
		var originalRows,features,coins,gems;
		function generateLevel(downy) {
			rows = {};
			let octaves = [];
			for (let i = 0; i < 5; i++) {
				octaves.push(new Simple1DNoise());
			};
			for (let i = 0; i < 10000; i++) {
				let perlinHeight = 0;
				for (let j = 0; j < octaves.length; j++) {
					perlinHeight += ((octaves[j].getVal(i / 10) - downy) * 4) / (2 ** j);
				};
				rows[i] = (rows[i - 1] ?? 0) + perlinHeight; // (Math.floor(Math.random() * 7) - 3);
			};
			for (row in Object.keys(rows)) {
				rows[row] = Math.floor(rows[row]);
			};
			originalRows = structuredClone(rows);

			features = new Uint8ClampedArray(Object.keys(rows).length);
			coins = 0;
			gems = 0;
			for (let i = 0; i < Object.keys(rows).length; i++) {// 0-air 1-coin 2-gem
				let pool = [];
				if (Math.random() < 0.05) {
					pool.push(1);
				};
				if (Math.random() < 0.005) {
					pool.push(2);
				};
				features[i] = pool.length == 0 ? 0 : pool[Math.floor(Math.random() * pool.length)];
			};
		};
		generateLevel(0.5);
		playerY = rows[1] * -50 - 50;
		var fac = 
			"Marina silva is a brazilian politician and an activist for deforestation and other things. She was a rubber tapper and found that land was being invaded by rubber tappers and she started protecting thousands of hectares of land."
		;
		var facasd = false;
		var shop = false;
		var bootses = {
			"sketchers": {bought: true, cost: 0},
			"running shoes": {bought: false, cost: 50},
			"tennis rackets": {bought: false, cost: 100},
			"spring boots": {bought: false, cost: 120},
		};
		var foods = {
			"apple": {cost: 5, hunger: 0.1, howmany: 0},
			"bread": {cost: 10, hunger: 0.2, howmany: 0},
			"burger": {cost: 14, hunger: 0.3, howmany: 0},
			"cold meal": {cost: 19, hunger: 0.4, howmany: 0},
			"meal": {cost: 23, hunger: 0.5, howmany: 0},
			"warm meal": {cost: 27, hunger: 0.6, howmany: 0},
			"hot meal": {cost: 31, hunger: 0.7, howmany: 0},
			"crispy gooey homemade mac and cheese": {cost: 34, hunger: 0.8, howmany: 0},
			"cow brain": {cost: 38, hunger: 0.9, howmany: 0},
			"filling warm meal": {cost: 41, hunger: 1, howmany: 0}
		};
		var boots = "sketchers";
		var health = 1;
		var dead = false;
		var ladders = 0;
		var inLadder = false;
		var joystick = new Joystick(document.getElementById("joystick"));
		var controls = {
			up: false,
			down: false,
			left: false,
			right: false
		};


		function getHittableRows() {
			hittableRows = [];
			if (Math.mod(playerX, 50) < 25) {
				hittableRows.push(Math.floor(playerX / 50) - 1);
			};
			hittableRows.push(Math.floor(playerX / 50));
			if (Math.mod(playerX, 50) > 25) {
				hittableRows.push(Math.floor(playerX / 50) + 1);
			};
			return hittableRows;
		};
		function getLayer(y) {
			return Math.floor(y / 100);
		};
		function clamp(number, min, max) {
			return Math.min(Math.max(number, min), max);
		};
		function lerp(a, b, c) {
			return a * (1 - c) + b * c;
		};
		function Simple1DNoise() {
			let MAX_VERTICES = 256;
			let MAX_VERTICES_MASK = MAX_VERTICES -1;
			let amplitude = 1;
			let scale = 1;

			let r = [];

			for (let i = 0; i < MAX_VERTICES; ++i) {
				r.push(Math.random()); // mulberry32(i + 100));
			};
		
			var getVal = function(x){
				let scaledX = x * scale;
				let xFloor = Math.floor(scaledX);
				let t = scaledX - xFloor;
				let tRemapSmoothstep = t * t * (3 - 2 * t);
			
				/// Modulo using &#038;
				let xMin = xFloor & MAX_VERTICES_MASK;
				let xMax = ( xMin + 1 ) & MAX_VERTICES_MASK;
			
				let y = lerp(r[xMin], r[xMax], tRemapSmoothstep);
			
				return y * amplitude;
			};
		
			// return the API
			return {
				getVal: getVal,
				setAmplitude: function(newAmplitude) {
					amplitude = newAmplitude;
				},
				setScale: function(newScale) {
					scale = newScale;
				}
			};
		};
		function mulberry32(a) {
			let t = a += 0x6D2B79F5;
			t = Math.imul(t ^ t >>> 15, t | 1);
			t ^= t + Math.imul(t ^ t >>> 7, t | 61);
			return ((t ^ t >>> 14) >>> 0) / 4294967296;
		};
		function shopButton() {
			if (shop = !shop) {
				document.getElementById("shop").style.display = "block";
			} else {
				document.getElementById("shop").style.display = "none";
				document.getElementById("canvas-wrapper").focus();
			};
		};
		function clickShoeButton(button, bootsreal) {
			if (bootses[bootsreal].bought) {
				boots = bootsreal;
			} else {
				if (coins >= bootses[bootsreal].cost) {
					bootses[bootsreal].bought = true;
					coins -= bootses[bootsreal].cost
				} else {
					alert("bankrupt");
				};
			};
		};
		function purchaseFood(food) {
			if (coins >= foods[food].cost) {
				foods[food].howmany++;
				coins -= foods[food].cost;
			} else {
				alert("bankrupt");
			};
		};
		function devourFood(food) {
			if (foods[food].howmany >= 1) {
				foods[food].howmany--;
				health += foods[food].hunger;
				health = clamp(health, 0, 1);
			};
		};
		function keyDownFunction(e) {
			keysDown[e.key] = true;
			if (e.key == 't') {
				facasd = true;
				setTimeout(() => {
					facasd = false;
				}, 3000);
			} else if (e.key == " ") {
				features[Math.floor(playerX / 50)] = 3;
			} else if (e.key == "Escape") {
				shopButton();
			};
		};
		function purchaseLadder() {
			if (coins >= 10) {
				coins -= 10;
				ladders++;
			} else {
				alert("bankrupt");
			};
		};
		function placeLadder() {
			if (ladders >= 1 && features[Math.floor(playerX / 50)] == 0) {
				features[Math.floor(playerX / 50)] = 3;
				ladders--;
			};
		};

		function loop() {
			document.getElementById("joystick").style.display = document.getElementById("joystick-checkbox").checked ? "flex" : "none";
			controls.up = isDown("ArrowUp") || (joystick.strength > 0.5 && (joystick.angle > 112.5 || joystick.angle < -112.5));
			controls.down = isDown("ArrowDown") || (joystick.strength > 0.5 && (joystick.angle > -67.5 || joystick.angle < 67.5));
			controls.left = isDown("ArrowLeft") || (joystick.strength > 0.5 && (joystick.angle > -157.5 && joystick.angle < -22.5));
			controls.right = isDown("ArrowRight") || (joystick.strength > 0.5 && (joystick.angle > 22.5 && joystick.angle < 157.5));
			if (!shop && !dead) {
				if (controls.right != controls.left) {
					let sign = (controls.right - controls.left);
					playerXV = inLadder ? sign * 5 : (sign * (boots == "running shoes" ? 16 : 10) + (sign * 2 * (controls.up && onGround)));
				};
				playerX += playerXV;
				let hittableRows;
				let playerColliding = () => {
					hittableRows = getHittableRows();
					return rows[hittableRows[0]] * -50 < playerY + 50 || rows[hittableRows[1]] * -50 < playerY + 50 || rows[hittableRows[2]] * -50 < playerY + 50;
				};
				if (playerColliding()) {
					let max = getHittableRows().reduce((a, b) => rows[a] > rows[b] ? a : b);
					if (onGround && playerY / -50 - 1 > rows[max] - 0.5) {
						playerY -= (rows[max] - (playerY / -50 - 1)) * 50;
					} else {
						playerX = Math.ceil(playerX / 50) * 50 - 25;
						playerXV = 0;
					};
				};
				if (inLadder) {
					playerYV = (controls.down - controls.up) * 5;
				} else {
					playerYV += controls.up * onGround * ((boots == "spring boots" ? -15 : -12) - Math.abs(playerXV) * 0.15);
				};
				playerY += playerYV;
				hittableRows = getHittableRows();
				let max = hittableRows.reduce((a, b) => rows[a] > rows[b] ? a : b);
				let oldOnGround = onGround;
				onGround = playerY > rows[max] * -50 - 50;
				if (!oldOnGround && onGround && playerYV > 30) {
					health -= playerYV * 0.001;
				};
				if (onGround) {
					if (getLayer(rows[max]) == 2 && rows[max] - 200 > (originalRows[max] - 200) * 0.9 && boots != "tennis rackets") {
						rows[max] -= 0.005;
					};
					playerY = rows[max] * -50 - 50;
					playerYV = 0;
				};
				let oldInLadder = inLadder;
				inLadder = false;
				for (let i = 0; i < features.length; i++) {
					if (playerX / 50 + 0.5 > i && playerX / 50 - 0.5 < i + 1) {
						if (playerY / -50 - 1 < rows[i] + 1) {
							switch (features[i]) {
								case 1:
									coins++;
									features[i] = 0;
									break;
								case 2:
									gems++;
									features[i] = 0;
									break;
							};
						};
						if (playerY / -50 - 1 < rows[i] + 4 && features[i] == 3) {
							inLadder = true;
						};
						if (inLadder != oldInLadder) {
							playerXV = 0;
							playerYV = 0;
						};
					};
				};
				playerXV *= inLadder ? 0 : (onGround ? layers[clamp(getLayer(playerY / -50), Math.min(...Object.keys(layers)), Math.max(...Object.keys(layers)))][1] : 0.99);
				playerYV += inLadder ? 0 : 0.6;
				cameraX = (cameraX * 3 + (playerX - canvas.width / 2)) / 4;
				cameraY = (cameraY * 3 + (playerY - canvas.height / 2)) / 4;

				health -= 0.00008;
				health = clamp(health, 0, 1);
				dead = health <= 0;

				ctx.clearRect(0, 0, canvas.width, canvas.height);

				ctx.drawImage(images.sky.image, 0, 0, canvas.width, canvas.height);
				
				//ctx.drawImage(images.stoneBackground.image, Math.mod(-cameraX, canvas.width * 4) / 4,					Math.mod(-cameraY, canvas.height * 4) / 4,					canvas.width, canvas.height);
				//ctx.drawImage(images.stoneBackground.image, Math.mod(-cameraX, canvas.width * 4) / 4 - canvas.width,	Math.mod(-cameraY, canvas.height * 4) / 4,					canvas.width, canvas.height);
				//ctx.drawImage(images.stoneBackground.image, Math.mod(-cameraX, canvas.width * 4) / 4,					Math.mod(-cameraY, canvas.height * 4) / 4 - canvas.height,	canvas.width, canvas.height);
				//ctx.drawImage(images.stoneBackground.image, Math.mod(-cameraX, canvas.width * 4) / 4 - canvas.width,	Math.mod(-cameraY, canvas.height * 4) / 4 - canvas.height,	canvas.width, canvas.height);
				
				ctx.drawImage(images.hills.image, 0, 200, images.hills.image.width, images.hills.image.height - 200, Math.mod(-cameraX, canvas.width * 4) / 4, (200 - cameraY) / 4, canvas.width, 500);
				ctx.drawImage(images.hills.image, 0, 200, images.hills.image.width, images.hills.image.height - 200, Math.mod(-cameraX, canvas.width * 4) / 4 - canvas.width, (200 - cameraY) / 4, canvas.width, 500);

				// grass
				let rowBuffer = Object.keys(rows).map(it=>parseInt(it)).filter(it => it * 50 + 50 > cameraX && it * 50 < cameraX + canvas.width)
				for (let i = 0; i < rowBuffer.length; i++) {
					let ice = getLayer(rows[rowBuffer[i]]) == 2 && rows[rowBuffer[i]] - 100 < (originalRows[rowBuffer[i]] - 100) * 0.9;
					let groundImage = ice ? images.packedSnow.image : layers[clamp(getLayer(rows[rowBuffer[i]]), Math.min(...Object.keys(layers)), Math.max(...Object.keys(layers)))][0];
					let imageWidth = groundImage.height * (50 / (canvas.height * 2));
					let imageHeight = rows[rowBuffer[i]] * -50 - cameraY;
					ctx.drawImage(groundImage, Math.floor(((imageWidth * rowBuffer[i]) % (Math.floor(groundImage.width / imageWidth) * imageWidth)) / imageWidth) * imageWidth, 0, imageWidth, groundImage.height, rowBuffer[i] * 50 - cameraX, imageHeight, 50, canvas.height * 2);
					switch (features[rowBuffer[i]]) {
						case 1:
							ctx.drawImage(images.coin.image, rowBuffer[i] * 50 - cameraX, imageHeight - 50, 50, 50);
							break;
						case 2:
							ctx.drawImage(images.gem.image, rowBuffer[i] * 50 - cameraX, imageHeight - 50, 50, 50);
							break;
						case 3:
							ctx.drawImage(images.ladder.image, rowBuffer[i] * 50 - cameraX, imageHeight - 200, 50, 200);
					};
				};
			
				ctx.drawImage(images.guy.image, playerX - 25 - cameraX, playerY - 50 - cameraY, 50, 100);
				ctx.font = "30px arial";
				ctx.fillStyle = "yellow";
				if (facasd) {
					ctx.fillText("Marina silva is a brazilian politician and an activist for deforestation and other things.", 0, 300);
					ctx.fillText("She was a rubber tapper and found that land was being invaded by rubber tappers and she", 0, 325);
					ctx.fillText("started protecting thousands of hectares of land.", 0, 350);
				};
			};
			let r = clamp(2 - health * 2, 0, 1) * 255;
			let g = clamp(health * 2, 0, 1) * 255;
			document.getElementById("health-inner").style.width = 600 * health + "px";
			document.getElementById("health-inner").style.backgroundColor = "rgb(" + r + ", " + g + ", 0)";
			if (dead) {
				ctx.font = "100px arial";
				ctx.fillText("you died", 200, 200);
			};
			document.getElementById("stats").innerHTML = "score: " + Math.floor(playerX / 50) + "<br>coins: " + coins + "<br>gems: " + gems + "<br>boots: " + boots + "<br>angle: " + joystick.angle + "<br>strength: " + joystick.strength;
			for (food in foods) {
				document.getElementById(food.replaceAll(" ", "-") + "-howmany").innerHTML = "(" + foods[food].howmany + ")";
			};
			document.getElementById("ladder-howmany").innerHTML = "(" + ladders + ")";

			requestAnimationFrame(()=>{try{loop()} catch (e) {alert(e.stack)}});
		};
		ctx.font = "100px arial";
		ctx.fillText("loading textures", 100, 100);
	</script>
</html>
