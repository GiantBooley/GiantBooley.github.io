<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Virus simulator</title>
		<style>
			* {
				box-sizing: border-box;
			}
			html,body {
				width: 100%;
				height: 100%;
			}
			body {
				margin: 0;
				overflow: hidden;
			}
			#game-wrapper {
				outline: none;
				width: 100%;
				height: 100%;
				cursor: default;
			}
			#canvas {
				width: 100%;
				height: 100%;
			}
			button {
				position: absolute;
				user-select: none;
				border: 5px ridge blue;
				background-color: lightgray;
				border-radius: 10px;
				padding: 0.5em 1em;
				cursor: pointer;
				color: yellow;
				text-shadow: 0px 0px 3px black;
				font-size: 20px;
				font-family: monospace;
				font-weight: bold;
			}
			button:hover {
				background-color: lightblue;
			}
			button:active {
				background-color: #AAAAFF;
			}
			#speed-up-button {
				top: 0px;
				right: 0px;
			}
			#shop-tab {
				transform: translateX(20px);
				border-radius: 10px 10px 0px 0px;
				border-bottom: none;
			}
			#shop {
				background-color: lightgray;
				border-top: 5px ridge blue;
				width: 100%;
				height: 100px;
			}
			#shop-wrapper {
				position: absolute;
				bottom: 0px;
				left: 0px;
				width: 100%;
				transform: translateY(100px);
				transition-duration: 0.4s;
				transition-timing-function: ease-out;
			}
			#shop-wrapper.open {
				transform: translateY(0px);
			}
		</style>
	</head>
	<body>
		<div id="game-wrapper" tabindex="0" onmousemove="mouseMove(event);">
			<canvas id="canvas"></canvas>
			<div id="shop-wrapper">
				<button id="shop-tab">Shop</button>
				<div id="shop"></div>
			</div>
			<button id="speed-up-button" onmousedown="gameSpeed = 15" onmouseup="gameSpeed = 1" onmouseleave="gameSpeed = 1">>></button>
		</div>
	</body>
	<script>
		class Person {
			constructor() {
				this.radius = 10;
				this.x = lerp(this.radius, canvas.width - this.radius, Math.random());
				this.y = lerp(this.radius, canvas.height - this.radius, Math.random());
				this.dir = lerp(0, 360, Math.random());
				this.speed = 5;
				this.infected = false;
				this.infectedTime = 0;
			};
			get hitbox() {
				return {
					top: this.y - this.radius,
					bottom: this.y + this.radius,
					left: this.x - this.radius,
					right: this.x + this.radius
				};
			};
			draw() {
				draw.circle(this.x, this.y, this.radius);
			};
		};
		const canvas = document.getElementById("canvas");
		canvas.width = innerWidth;
		canvas.height = innerHeight;
		const ctx = canvas.getContext("2d");

		Array.prototype.realMap = function(mapFunction){
			let newArray = [...this];
			for (let i = 0; i < this.length; i++) {
				newArray[i] = mapFunction(this[i], i, this);
			};
			return newArray;
		};
		Array.prototype.random = function(){
			return this[Math.floor(Math.random() * this.length)];
		};

		var mouseX = 0;
		var mouseY = 0;
		var gameSpeed = 1;

		var game = {
			people: new Array(100).realMap(person => new Person())
		};
		game.people.random().infected = true;
		var draw = {
			circle: function(x, y, radius){
				ctx.beginPath();
				ctx.arc(x, y, radius, 0, 2 * Math.PI);
				ctx.fill();
			}
		};


		function mouseMove(e) {
			mouseX = e.clientX;
			mouseY = e.clientY;
		};
		function distance(p1, p2) {
			return Math.sqrt(((p1[0] - p2[0]) ** 2) + ((p1[1] - p2[1]) ** 2));
		};
		function lerp(min, max, mult) {
			return (max - min) * mult + min;
		};
		function deg2rad(degrees) {
			return degrees * (Math.PI / 180);
		};

		function tick() {
			for (let i = 0; i < gameSpeed; i++) {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				game.people.forEach((person, personNumber) => {
					person.dir += lerp(-15, 15, Math.random());
					let oldX = person.x;
					let oldY = person.y;
					person.x += Math.sin(deg2rad(person.dir));
					if (person.hitbox.left < 0 || person.hitbox.right > canvas.width) {
						person.x = oldX;
					};
					person.y += Math.cos(deg2rad(person.dir));
					if (person.hitbox.top < 0 || person.hitbox.bottom > canvas.height) {
						person.y = oldY;
					};
					person.infectedTime += person.infected;
					person.infected = person.infected || game.people.some(otherperson => person !== otherperson && distance([person.x, person.y], [otherperson.x, otherperson.y]) < 40 && otherperson.infected && Math.random() < 1/50);
					if (person.infectedTime > 5000) {
						if (Math.random() < 1/4) {
							game.people.splice(personNumber, 1);
							return;
						} else {
							person.infected = false;
							person.infectedTime = 0;
						};
					};
					
					ctx.fillStyle = person.infected ? "red" : "black";
					person.draw();
				});
			};
			
			requestAnimationFrame(tick);
		};
		tick();
	</script>
</html
